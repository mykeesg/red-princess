let e=!1;const t=["NORTH","NORTH_EAST","SOUTH_EAST","SOUTH","SOUTH_WEST","NORTH_WEST"],s={steps:"ğŸ‘£",keys:"ğŸ”‘",lock:"ğŸ”’",gems:"ğŸ’"},o={spiral:"ğŸŒ€",diamond:"ğŸ”¶",loop:"â°",bright:"ğŸ”†",circle:"ğŸ”´",square:"ğŸŸ©"},r={target:"ğŸ¯",star:"âœ´ï¸",slash:"ã€°ï¸",paint:"ğŸ¨",egg:"ğŸ¥š",grid:"ğŸ”³"};const i=new class{#e;constructor(e=0){this.setSeed(e)}setSeed(e){this.#e=e??Math.floor(Math.random()*Math.pow(2,31))+1}float(){return this.#e^=this.#e<<13,this.#e^=this.#e>>17,this.#e^=this.#e<<5,(this.#e>>>0)/4294967295}int32(){return this.#e^=this.#e<<13,this.#e^=this.#e>>17,this.#e^=this.#e<<5,0|this.#e}get seed(){return this.#e}}(Date.now()),n=()=>i.float(),a=(e=0)=>{return e?(t=0,s=e,Math.floor(n()*(s-t))+t):i.int32();var t,s},l=e=>e[a(e.length)],d={extraSteps:{invoke:()=>S.addResource("steps",2),description:"Take a rest.",triggerText:"You have gained 2 extra steps.",triggerLimit:-1,rarity:.5},extraKey:{invoke:()=>S.addResource("keys"),description:"Alohomora.",triggerText:"You have found a key.",triggerLimit:1,rarity:.3},money:{invoke:()=>S.addResource("gems"),description:"What's that spark in the corner?",triggerText:"You have found a gem.",triggerLimit:1,rarity:.3},taxes:{invoke:()=>S.removeResource("gems"),description:"Takes a toll on you.",triggerText:`You have to pay taxes: ${s.gems}`,triggerLimit:-1,rarity:.3},garden:{invoke:()=>S.setResource("steps",41),description:"Like starting again.",triggerText:"Your steps have been reset.",triggerLimit:-1,rarity:.4},shop:{invoke:()=>{S.getResource("gems")>=5&&(S.addResource("keys"),S.removeResource("gems",5))},description:"Buy your passage.",triggerText:"You can buy a key for #5 with [Space].",triggerLimit:1,rarity:.9},exit:{invoke:()=>{S.pause()},description:"",triggerText:"You have won!",triggerLimit:-1,rarity:0},noop:{invoke:()=>{},description:"A simple room.",triggerText:"",triggerLimit:-1,rarity:.7}};class h{constructor({from:e,to:t,duration:s,ease:o=e=>e,onUpdate:r,onComplete:i,loop:n=!1,reverse:a=!1,type:l=""}){this.from=e,this.to=t,this.duration=s,this.ease=o,this.onUpdate=r,this.onComplete=i,this.loop=n,this.reverse=a,this.active=!0,this.startTime=performance.now(),this.type=l}update(e){const t=Math.min((e-this.startTime)/this.duration,1),s=this.ease(t),o=this.from+(this.to-this.from)*s;this.onUpdate(o),1===t&&(this.loop?(this.reverse&&([this.from,this.to]=[this.to,this.from]),this.startTime=e):(this.active=!1,this.onComplete?.()))}}let c=[new h({from:.1,to:1,duration:800,loop:!0,reverse:!0,onUpdate:e=>K=e,type:"selection-pulse"}),new h({from:0,to:2*Math.PI,duration:2e3,loop:!0,onUpdate:e=>q=e,type:"refresh-rotate"})];class u{events;hallways;revealed;triggerCount;needsKey;items;constructor(e=void 0){e?(this.events=e.events,this.hallways=e.hallways,this.revealed=e.revealed,this.triggerCount=e.triggerCount,this.needsKey=e.needsKey,this.items=e.items):this.#t()}#t(){this.events={enter:"noop",exit:"noop",use:"noop"},this.hallways={NORTH:{status:"unknown",enabled:!0},NORTH_EAST:{status:"unknown",enabled:!0},SOUTH_EAST:{status:"unknown",enabled:!0},SOUTH:{status:"unknown",enabled:!0},SOUTH_WEST:{status:"unknown",enabled:!0},NORTH_WEST:{status:"unknown",enabled:!0}},this.revealed=!1,this.triggerCount=0,this.needsKey=!1,this.items=[]}#s(e){-1===d[e].triggerLimit?(d[e].invoke(),S.lastEffect=d[e].triggerText):this.triggerCount<d[e].triggerLimit?(d[e].invoke(),S.lastEffect=d[e].triggerText,this.triggerCount+=1):S.lastEffect=""}enter(){this.#s(this.events.enter)}use(){this.#s(this.events.use)}exit(){this.#s(this.events.exit)}copy(){return new u(JSON.parse(JSON.stringify(this)))}}const f=document.querySelector("#canvas"),g=f.getContext("2d"),y={AliceBlue:"#F0F8FF",AntiqueWhite:"#FAEBD7",Aqua:"#00FFFF",Aquamarine:"#7FFFD4",Azure:"#F0FFFF",Beige:"#F5F5DC",Bisque:"#FFE4C4",Black:"#000000",BlanchedAlmond:"#FFEBCD",Blue:"#0000FF",BlueViolet:"#8A2BE2",Brown:"#A52A2A",BurlyWood:"#DEB887",CadetBlue:"#5F9EA0",Chartreuse:"#7FFF00",Chocolate:"#D2691E",Coral:"#FF7F50",CornflowerBlue:"#6495ED",Cornsilk:"#FFF8DC",Crimson:"#DC143C",Cyan:"#00FFFF",DarkBlue:"#00008B",DarkCyan:"#008B8B",DarkGoldenRod:"#B8860B",DarkGray:"#A9A9A9",DarkGrey:"#A9A9A9",DarkGreen:"#006400",DarkKhaki:"#BDB76B",DarkMagenta:"#8B008B",DarkOliveGreen:"#556B2F",DarkOrange:"#FF8C00",DarkOrchid:"#9932CC",DarkRed:"#8B0000",DarkSalmon:"#E9967A",DarkSeaGreen:"#8FBC8F",DarkSlateBlue:"#483D8B",DarkSlateGray:"#2F4F4F",DarkSlateGrey:"#2F4F4F",DarkTurquoise:"#00CED1",DarkViolet:"#9400D3",DeepPink:"#FF1493",DeepSkyBlue:"#00BFFF",DimGray:"#696969",DimGrey:"#696969",DodgerBlue:"#1E90FF",FireBrick:"#B22222",FloralWhite:"#FFFAF0",ForestGreen:"#228B22",Fuchsia:"#FF00FF",Gainsboro:"#DCDCDC",GhostWhite:"#F8F8FF",Gold:"#FFD700",GoldenRod:"#DAA520",Gray:"#808080",Grey:"#808080",Green:"#008000",GreenYellow:"#ADFF2F",HoneyDew:"#F0FFF0",HotPink:"#FF69B4",IndianRed:"#CD5C5C",Indigo:"#4B0082",Ivory:"#FFFFF0",Khaki:"#F0E68C",Lavender:"#E6E6FA",LavenderBlush:"#FFF0F5",LawnGreen:"#7CFC00",LemonChiffon:"#FFFACD",LightBlue:"#ADD8E6",LightCoral:"#F08080",LightCyan:"#E0FFFF",LightGoldenRodYellow:"#FAFAD2",LightGray:"#D3D3D3",LightGrey:"#D3D3D3",LightGreen:"#90EE90",LightPink:"#FFB6C1",LightSalmon:"#FFA07A",LightSeaGreen:"#20B2AA",LightSkyBlue:"#87CEFA",LightSlateGray:"#778899",LightSlateGrey:"#778899",LightSteelBlue:"#B0C4DE",LightYellow:"#FFFFE0",Lime:"#00FF00",LimeGreen:"#32CD32",Linen:"#FAF0E6",Magenta:"#FF00FF",Maroon:"#800000",MediumAquaMarine:"#66CDAA",MediumBlue:"#0000CD",MediumOrchid:"#BA55D3",MediumPurple:"#9370DB",MediumSeaGreen:"#3CB371",MediumSlateBlue:"#7B68EE",MediumSpringGreen:"#00FA9A",MediumTurquoise:"#48D1CC",MediumVioletRed:"#C71585",MidnightBlue:"#191970",MintCream:"#F5FFFA",MistyRose:"#FFE4E1",Moccasin:"#FFE4B5",NavajoWhite:"#FFDEAD",Navy:"#000080",OldLace:"#FDF5E6",Olive:"#808000",OliveDrab:"#6B8E23",Orange:"#FFA500",OrangeRed:"#FF4500",Orchid:"#DA70D6",PaleGoldenRod:"#EEE8AA",PaleGreen:"#98FB98",PaleTurquoise:"#AFEEEE",PaleVioletRed:"#DB7093",PapayaWhip:"#FFEFD5",PeachPuff:"#FFDAB9",Peru:"#CD853F",Pink:"#FFC0CB",Plum:"#DDA0DD",PowderBlue:"#B0E0E6",Purple:"#800080",RebeccaPurple:"#663399",Red:"#FF0000",RosyBrown:"#BC8F8F",RoyalBlue:"#4169E1",SaddleBrown:"#8B4513",Salmon:"#FA8072",SandyBrown:"#F4A460",SeaGreen:"#2E8B57",SeaShell:"#FFF5EE",Sienna:"#A0522D",Silver:"#C0C0C0",SkyBlue:"#87CEEB",SlateBlue:"#6A5ACD",SlateGray:"#708090",SlateGrey:"#708090",Snow:"#FFFAFA",SpringGreen:"#00FF7F",SteelBlue:"#4682B4",Tan:"#D2B48C",Teal:"#008080",Thistle:"#D8BFD8",Tomato:"#FF6347",Turquoise:"#40E0D0",Violet:"#EE82EE",Wheat:"#F5DEB3",White:"#FFFFFF",WhiteSmoke:"#F5F5F5",Yellow:"#FFFF00",YellowGreen:"#9ACD32"},p=e=>{e.fill&&(g.fillStyle=e.fill,g.fill()),e.border&&(g.strokeStyle=e.border,g.lineWidth=e.borderWidth??O("xs")/10,g.stroke())},m=(e,t,s)=>e<t?t:e>s?s:e,F={noop:"#AF6C31",taxes:"#AE0000",garden:"#2F8043",shop:"#D7DE87",extraSteps:"#6E5381",money:y.Tan,extraKey:y.Gold,exit:"#005A8D",draft:y.LightSteelBlue},w=y.Black,T="#1D1D1D";const S=new class{#o;#r;#i;#n;#a;#l;#d;#h;#c;#u;#f;mouseX;mouseY;mouseGridRow;mouseGridCol;constructor(){this.newGame()}newGame(){this.#o=5,this.#r=13,this.#i=Array.from({length:this.#o},()=>Array.from({length:this.#r},()=>new u)),this.#n={row:2,col:0},this.atCoord(this.player).events={enter:"noop",exit:"noop",use:"noop"},this.atCoord(this.player).revealed=!0,this.atCoord(this.player).hallways={NORTH:{status:"unknown",enabled:!0},NORTH_EAST:{status:"unknown",enabled:!0},SOUTH_EAST:{status:"unknown",enabled:!0},SOUTH:{status:"unknown",enabled:!0},SOUTH_WEST:{status:"blocked",enabled:!0},NORTH_WEST:{status:"blocked",enabled:!0}},this.#a={row:2,col:9},this.atCoord(this.exit).events={enter:"exit",exit:"noop",use:"noop"},this.atCoord(this.exit).revealed=!0,this.atCoord(this.exit).hallways={NORTH:{status:"unknown",enabled:!0},NORTH_EAST:{status:"blocked",enabled:!0},SOUTH_EAST:{status:"blocked",enabled:!0},SOUTH:{status:"unknown",enabled:!0},SOUTH_WEST:{status:"unknown",enabled:!0},NORTH_WEST:{status:"unknown",enabled:!0}},this.#f={index:0,position:{row:0,col:0},direction:"NORTH",options:[new u,new u,new u]},this.#f.options.forEach(e=>e.revealed=!0),this.#d={steps:40,keys:1,gems:0},this.mouseX=-1,this.mouseY=-1,this.mouseGridRow=-1,this.mouseGridCol=-1,this.#u=0,this.#c="noop",this.setState("move"),this.play()}get rows(){return this.#o}get cols(){return this.#r}get player(){return this.#n}get exit(){return this.#a}movePlayerTo(e,t){this.#n.row=e,this.#n.col=t}movePlayerToCoord(e){this.movePlayerTo(e.row,e.col)}at(e,t){return this.#i[e][t]}atCoord(e){return this.at(e.row,e.col)}placeRoom(e,t,s){this.valid(e,t)&&(this.#i[e][t]=s)}valid(e,t){return 0<=e&&e<this.#o&&0<=t&&t<this.#r}validCoord(e){return this.valid(e.row,e.col)}setState(e){this.#l=e}getState(){return this.#l}#g(e,t,s){this.at(e,t).revealed=s}#y(e,t){this.#g(e,t,!0)}#p(e,t){this.#g(e,t,!1)}isRevealed(e,t){return this.at(e,t).revealed}isRevealedCoord(e){return this.isRevealed(e.row,e.col)}isHidden(e,t){return!this.isRevealed(e,t)}isHiddenCoord(e){return this.isHidden(e.row,e.col)}getResource(e){return this.#d[e]??0}addResource(e,t=1){e in this.#d||(this.#d[e]=0),this.#d[e]+=t}removeResource(e,t=1){e in this.#d&&(this.#d[e]-=t,this.#d[e]<0&&(this.#d[e]=0))}setResource(e,t){this.#d[e]=t}getResources(){return Object.entries(this.#d).map(([e,t])=>({type:e,count:t}))}pause(){this.#h=!1}play(){this.#h=!0}get isRunning(){return this.#h}get draft(){return this.#f}get lastTimeStamp(){return this.#u}set lastTimeStamp(e){this.#u=e}get lastEffect(){return this.#c}set lastEffect(e){this.#c=e}},x=e=>S.atCoord(e),v={NORTH:{row:-1,col:0},NORTH_EAST:{row:0,col:1},SOUTH_EAST:{row:1,col:1},SOUTH:{row:1,col:0},SOUTH_WEST:{row:1,col:-1},NORTH_WEST:{row:0,col:-1}},k={NORTH:{row:-1,col:0},NORTH_EAST:{row:-1,col:1},SOUTH_EAST:{row:0,col:1},SOUTH:{row:1,col:0},SOUTH_WEST:{row:0,col:-1},NORTH_WEST:{row:-1,col:-1}},E=(e,t)=>{const s=e.col%2==0?k[t]:v[t];return r=s,{row:(o=e).row+r.row,col:o.col+r.col};var o,r},A=e=>{if("NORTH"===e)return"SOUTH";if("NORTH_EAST"===e)return"SOUTH_WEST";if("SOUTH_EAST"===e)return"NORTH_WEST";if("SOUTH"===e)return"NORTH";if("SOUTH_WEST"===e)return"NORTH_EAST";if("NORTH_WEST"===e)return"SOUTH_EAST";throw new Error},D=(e,s)=>{const o=(()=>{const e=Object.values(d).reduce((e,t)=>e+t.rarity,0);let t=n()*e;for(const e of Object.keys(d))if(t-=d[e].rarity,t<=0)return e;throw new Error})(),r=S.draft.options[e];r.events={enter:o,exit:"noop",use:"noop"},"extraKey"===o?r.items.push("keys"):r.items.length=0,t.forEach(e=>{((e,t,s)=>{const o=E(e,t);if(S.validCoord(o))if(n()<.4){const e=x(o);S.isHiddenCoord(o)?(s.hallways[t].enabled=!0,s.hallways[t].status="unknown"):e.hallways[A(t)].enabled?(s.hallways[t].enabled=!0,s.hallways[t].status="open"):(s.hallways[t].enabled=!0,s.hallways[t].status="blocked")}else s.hallways[t].enabled=!1,s.hallways[t].status="blocked";else s.hallways[t].enabled=!1,s.hallways[t].status="blocked"})(S.draft.position,e,r)}),r.hallways[A(s)].enabled=!0,r.hallways[A(s)].status="open",r.needsKey="extraKey"!==o&&a()%2==0},C=()=>{const e=S.draft.direction;S.draft.index=0;let t=!0;do{D(0,e),D(1,e),D(2,e),t=0!==S.getResource("keys")||-1!==S.draft.options.findIndex(e=>!e.needsKey)}while(!t)};const b=e=>{if(!S.isRunning)return;const t=E(S.player,e);if(!S.validCoord(t))return;if(S.getResource("steps")<=0)return;const s=x(S.player).hallways;s[e].enabled&&"blocked"!==s[e].status&&(S.isHiddenCoord(t)?(S.draft.position=t,S.draft.direction=e,S.setState("draft"),C()):x(t).hallways[A(e)].enabled&&(x(t).enter(),S.movePlayerToCoord(t),S.removeResource("steps")))},B=()=>{const e=S.draft.options[S.draft.index].copy();e.needsKey&&0===S.getResource("keys")||(e.needsKey&&(e.needsKey=!1,S.removeResource("keys")),S.placeRoom(S.draft.position.row,S.draft.position.col,e),b(S.draft.direction),S.draft.index=0,t.forEach(t=>{const s=E(S.draft.position,t);if(S.validCoord(s)&&S.isRevealedCoord(s)){const o=x(s);!e.hallways[t].enabled&&o.hallways[A(t)].enabled?o.hallways[A(t)].status="blocked":e.hallways[t].enabled&&o.hallways[A(t)].enabled&&(o.hallways[A(t)].status="open")}}),S.setState("move"))},R={xs:1,sm:2,md:3,lg:4,xl:5},O=e=>f.width/160*R[e],H=(e,s,o,r,i)=>{if(!e.enabled)return;const n={open:{factor:1,color:y.Lavender},blocked:{factor:.5,color:y.FireBrick},unknown:{factor:.75,color:"#e6e6e6"}},a=Math.sqrt(3)*r/2,l=n[e.status].factor;g.fillStyle=n[e.status].color,g.lineWidth=O("xs")/10,g.strokeStyle="black";var d,h,c,u,f;d=s,h=o,c=r/5,u=a*l,f=t.indexOf(i)*Math.PI/3,g.save(),g.translate(d,h),g.rotate(f),g.strokeRect(-c/2,-u,c,u),g.fillRect(-c/2,-u,c,u),g.restore()},M=(s,o,r,i,n=!1)=>{i.revealed?(I(s,o,r,{fill:F[i.events.enter],...n&&{border:y.Wheat,borderWidth:3}}),t.forEach(e=>{H(i.hallways[e],s,o,r,e)}),Y(s,o,r/5,{fill:y.Lavender,border:"black",borderWidth:.5})):e&&I(s,o,r,void 0,{fill:T,border:y.Wheat})},G=(e,t,s)=>{const o=O("sm"),r=o/3,i=o/5;g.save(),g.font=`${o}px monospace`;const n=g.measureText(e).width+2*r,a=o+2*i;g.fillStyle="#f0f0f0",g.strokeStyle="#333",g.lineWidth=O("xs")/10,g.fillRect(t-n/2,s-a/2,n,a),g.strokeRect(t-n/2,s-a/2,n,a),g.textBaseline="middle",g.textAlign="center",g.fillStyle="#333",g.lineWidth=O("xs")/10,g.fillText(e,t,s),g.restore()},P=(e,t)=>{g.save(),g.translate(e.x,e.y),t(e.width,e.height),g.restore()},W=(e,s)=>{const o=e/2,r=s/5;g.textAlign="center",g.textBaseline="top",g.fillStyle="white",g.font=`${O("xl")}px Consolas`,g.fillText("Movement",e/2,r);const i=o,n=2.5*r,a=.5*o;I(i,n,a,{fill:F.exit}),t.forEach(e=>{H({enabled:!0,status:"open"},i,n,a,e)}),Y(i,n,a/5,{fill:y.Lavender,border:"black",borderWidth:.5});const l=["D","S","A","Q","W","E"];for(let e=0;e<6;e++){const t=Math.PI/180*(60*e+30),s=i+1.1*a*Math.cos(t),o=n+1.1*a*Math.sin(t);g.textAlign="center",g.textBaseline="middle",G(l[e],s,o)}},L=(e,t,s,o,r,i)=>{const n=s-e,a=o-t,l=Math.hypot(n,a),d=Math.atan2(a,n);g.save(),g.translate(e,t),g.rotate(d),g.beginPath(),g.lineWidth=O("xs")/5;for(let e=0;e<=l;e++){const t=e,s=Math.sin(e/l*2*Math.PI*r)*i;0===e?g.moveTo(t,s):g.lineTo(t,s)}g.stroke(),g.restore()},_=new Map,U=(e,t,s)=>{const i=s/8,n=s/16;g.lineCap="round";const a=Object.values(o),d=Object.values(r),h=((e,t,s)=>{let o=_.get(e);if(!o){const r=["straight","wavy","dotted","dashed"];o={fillColor:l(Object.values(F)),innerSymbol:l(t),outerSymbol:l(s),lineType:l(r)},_.set(e,o)}return o})(`[${S.player.row};${S.player.col}]`,a,d);I(e,t,s,{fill:h.fillColor,border:"white",borderWidth:2}),g.setLineDash([i,n]);for(let o=0;o<6;o++){const r=Math.PI/180*(60*o+30),i=e+.6*s*Math.cos(r),n=t+.6*s*Math.sin(r);g.font=`${O("sm")}px monospace`,g.textAlign="center",g.textBaseline="middle",g.fillStyle="white",g.fillText(`${h.outerSymbol}`,i,n)}g.setLineDash([]),g.strokeStyle="white";for(let o=0;o<6;o++){const r=Math.PI/180*(60*o),i=e+1.5*O("xs")*Math.cos(r),n=t+1.5*O("xs")*Math.sin(r),a=e+s*Math.cos(r),l=t+s*Math.sin(r);if("wavy"===h.lineType)L(i,n,a,l,5,O("xs")/2);else{switch(h.lineType){case"straight":g.lineWidth=O("xs")/5,g.setLineDash([]);break;case"dotted":g.setLineDash([s/30]);break;case"dashed":g.setLineDash([s/5])}g.beginPath(),g.moveTo(i,n),g.lineTo(a,l),g.stroke()}}g.setLineDash([]),Y(e,t,O("xs"),{fill:"white"}),g.font=`${O("sm")}px monospace`,g.textAlign="center",g.textBaseline="middle",g.fillText(`${h.innerSymbol}`,e,t)},N=(e,t)=>{g.textAlign="center",g.textBaseline="top",g.fillStyle="white",g.font=`${O("md")}px monospace`,g.fillText("Resources",e/2,0),g.textAlign="left",g.font=`${O("sm")}px monospace`;const o=[];for(const{type:e,count:t}of S.getResources())o.push(`â€¢ ${s[e]} ${e.substring(0,1).toUpperCase()+e.substring(1)}: ${t}`);o.forEach((t,s)=>{g.fillText(t,e/2.5,(s+1)*O("lg"))});const r=e/2;U(r,3*(t/5),.5*r)},$=(e,t)=>{g.strokeStyle="#CECECE",g.lineWidth=O("xs")/5;const s=S.cols,o=S.rows,r=e/10/2;for(let e=0;e<o;e++)for(let t=0;t<s;t++){const s=Math.sqrt(3)*r,o=(1.5*t+1)*r,i=e*s+(t%2+1)*(s/2);M(o,i,r,S.at(e,t)),e===S.player.row&&t===S.player.col&&Y(o,i,O("xs"),{fill:w}),S.mouseGridRow===e&&S.mouseGridCol===t&&g.fillText(`[${e};${t}]`,o,i),"draft"===S.getState()&&e===S.draft.position.row&&t===S.draft.position.col&&(g.save(),g.fillStyle=F.draft,g.globalAlpha=K,M(o,i,.75*r,S.draft.options[S.draft.index]),g.restore())}};let K=1,q=0;const I=(e,t,s,o,r=void 0)=>{g.save(),g.beginPath();for(let o=0;o<6;o++){const r=Math.PI/180*(60*o),i=e+s*Math.cos(r),n=t+s*Math.sin(r);0===o?g.moveTo(i,n):g.lineTo(i,n)}g.closePath(),r?p(r):o&&p(o),g.restore()},Y=(e,t,s,o)=>{g.save(),g.beginPath(),g.arc(e,t,s,0,2*Math.PI),g.closePath(),p(o),g.restore()},j=(e,t)=>{if("draft"!==S.getState())return;const o=e/16,r=t/2;for(let e=0;e<S.draft.options.length;++e){const t=3*e+4.5,i=S.draft.options[e],n=t*o,a=r,l=.5*o;if(M(n,a,l,i,!0),e===S.draft.index){if("noop"!==d[i.events.enter].description){const e=1.75*r;g.textAlign="center",g.textBaseline="middle",g.fillStyle="white",g.font=`${O("sm")}px monospace`,g.fillText(d[i.events.enter].description,n,e)}if(i.needsKey){const e=(t-1.25)*o,i=r;g.font=`${O("lg")}px monospace`,g.textAlign="center",g.textBaseline="middle",g.fillText(s.lock,e,i)}if(i.items.includes("keys")){const e=(t+1.25)*o,i=r;g.font=`${O("lg")}px monospace`,g.textAlign="center",g.textBaseline="middle",g.fillText(s.keys,e,i)}const e=i.needsKey&&0===S.getResource("keys");g.save(),g.globalAlpha=K,I(n,a,1.2*l,{border:e?"red":"yellow",borderWidth:6}),g.restore()}}if(S.getResource("gems")>=2){((e,t,s=50)=>{const o=s/2,r=[{startAngle:.4*Math.PI,endAngle:Math.PI,sign:-1},{startAngle:1.4*Math.PI,endAngle:2*Math.PI,sign:1}];for(const i of r){const r=q+i.startAngle,n=q+i.endAngle;g.beginPath(),g.arc(e,t,s,r,n),g.strokeStyle="white",g.lineWidth=O("xs")/3,g.stroke(),g.save(),g.translate(e,t),g.rotate(q),g.beginPath();const a=o/2,l=Math.sqrt(3)/2*o;g.moveTo(i.sign*s-a,0),g.lineTo(i.sign*s+a,0),g.lineTo(i.sign*s,i.sign*l),g.closePath(),g.fillStyle="white",g.fill(),g.restore()}})(14.5*o,r,r/3),g.textAlign="center",g.textBaseline="middle",g.fillStyle="white",g.font=`${O("sm")}px monospace`,g.fillText(`2Ã—${s.gems}`,14.5*o,r),g.fillText("[R]",14.5*o,2*r)}},V=(e,t)=>{g.textAlign="center",g.textBaseline="top",g.fillStyle="white",g.font=`${O("sm")}px monospace`;const s=["Draft rooms by selecting an option and press [Space] or [Enter].","Some rooms are locked behind a key, so look out for them to help on your journey!","Different rooms can help or hinder you. Gems help you refresh your draft options. Spend them wisely!","Red paths are blocked from the other side. Gray ones are yet unvisited, while whites are already known.","Do not be afraid to explore for additional resources!"];s.length;s.forEach((t,s)=>{g.fillText(t,e/2,s*O("lg")+O("xs"))})},J=()=>{f.width=window.innerWidth,f.height=window.innerHeight,g.fillStyle=T,g.fillRect(0,0,f.width,f.height);const{x:t,y:s,width:o,height:r}=(()=>{const e=16/9,t=f.width,s=f.height;if(t/s>e){const o=s*e;return{x:(t-o)/2,y:0,width:o,height:s}}{const o=t/e;return{x:0,y:(s-o)/2,width:t,height:o}}})(),i=o/16,n=r/9,a={draft:{x:t,y:s,width:o,height:2*n},grid:{x:t+3*i,y:s+2*n,width:10*i,height:5*n},resources:{x:t,y:s+2*n,width:3*i,height:5*n},movement:{x:t+13*i,y:s+2*n,width:3*i,height:5*n},footer:{x:t,y:s+7*n,width:o,height:2*n}},l=S.rows,d=S.cols,h=Math.min(128,Math.floor(Math.min(f.width/d,f.height/l))),c=Math.floor((f.width-h*d)/2),u=Math.floor((f.height-h*l)/2);if(P(a.draft,j),P(a.resources,N),P(a.grid,$),P(a.movement,W),P(a.footer,V),e){g.strokeStyle=y.Pink,g.lineWidth=O("xs")/5;for(const[e,t]of Object.entries(a))g.strokeRect(t.x,t.y,t.width,t.height),g.textAlign="left",g.textBaseline="top",g.fillStyle=y.Pink,g.font=`${O("sm")}px monospace`,g.fillText(`[${e}]`,t.x+5,t.y+5)}return"noop"!==S.lastEffect&&(g.textAlign="right",g.textBaseline="middle",g.fillStyle="white",g.font=`${O("sm")}px monospace`,g.fillText(`${S.lastEffect}`,c+d*h-h/2,u-h/2)),!0},X={r:()=>S.newGame(),h:()=>{e=!e,f.style.cursor=e?"pointer":"default"},g:()=>S.addResource("gems",5),k:()=>S.addResource("keys",5)},z={w:()=>b("NORTH"),ArrowUp:()=>b("NORTH"),e:()=>b("NORTH_EAST"),d:()=>b("SOUTH_EAST"),s:()=>b("SOUTH"),ArrowDown:()=>b("SOUTH"),a:()=>b("SOUTH_WEST"),q:()=>b("NORTH_WEST")},Q={d:()=>S.draft.index=m(S.draft.index+1,0,S.draft.options.length-1),ArrowRight:()=>S.draft.index=m(S.draft.index+1,0,S.draft.options.length-1),a:()=>S.draft.index=m(S.draft.index-1,0,S.draft.options.length-1),ArrowLeft:()=>S.draft.index=m(S.draft.index-1,0,S.draft.options.length-1)," ":()=>B(),Enter:()=>B(),r:()=>{S.getResource("gems")>=2&&(S.removeResource("gems",2),C())}},Z=e=>{const t=e.key,s=S.getState();X[t]?X[t]():"move"===s&&z[t]?z[t]():"draft"===s&&Q[t]&&Q[t]()};let ee=performance.now();const te=e=>{const t=1e3/(e-ee);ee=e,S.lastTimeStamp=e,(e=>{for(const t of c)t.active&&t.update(e);c=c.filter(e=>e.active)})(e),J()?(g.textAlign="left",g.textBaseline="middle",g.fillStyle=y.Pink,g.font=`${O("sm")}px monospace`,g.fillText(`FPS: ${Math.round(t)}`,50,50)):(g.textAlign="center",g.textBaseline="middle",g.fillStyle=y.Red,g.font=`${O("sm")}px monospace`,g.fillText("Play area not suitable for this game, buy a proper display.",f.width/2,f.height/2)),requestAnimationFrame(te)};(async()=>{document.addEventListener("keydown",Z),te(0)})().then(()=>console.log("Game started."));